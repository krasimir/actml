!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).actml=e()}}(function(){return function u(i,c,s){function f(n,e){if(!c[n]){if(!i[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(l)return l(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var o=c[n]={exports:{}};i[n][0].call(o.exports,function(e){return f(i[n][1][e]||e)},o,o.exports,u,i,c,s)}return c[n].exports}for(var l="function"==typeof require&&require,e=0;e<s.length;e++)f(s[e]);return f}({1:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(e,n,t){if("function"!=typeof e)throw new Error('ActML element expects a function. "'+e+'" given instead.');return{__actml:!0,__used:0,__running:!1,id:null,props:n,name:function(e){if(e.name)return e.name;var n=/^function\s+([\w\$]+)\s*\(/.exec(e.toString());return n?n[1]:"unknown"}(e),children:t,initialize:function(e,n){var t=1<arguments.length&&void 0!==n?n:0;this.id=e,this.__used=t,this.__running=!1},mergeProps:function(e){this.props=Object.assign({},this.props,e)},used:function(){return this.__used},isRunning:function(){return this.__running},in:function(){this.__running=!0},consume:function(){return e(this.props)},out:function(){this.__used+=1,this.__running=!1}}}},{}],2:[function(e,n,t){"use strict";function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(u){return function(n){var e,o="c"+ ++s;return r(e={},c,function(){return f(u.node(),o)||n}),r(e,"Provider",function(e){var n=e.value,t=e.children,r=u.node();return r[i]||(r[i]={}),r[i][o]=n,t}),r(e,"Consumer",function(e){(0,e.children)(f(u.node(),o)||n)}),e}};var i="__CONTEXT_KEY__",c=t.PUBLIC_CONTEXT_KEY="__PUBLIC_CONTEXT_KEY__",s=0;function f(e,n,t){var r=2<arguments.length&&void 0!==t?t:[];return r.push(e.element.name),e[i]&&n in e[i]?e[i][n]:e.parent?f(e.parent,n,r):void console.warn("A context consumer is used with no provider.\n  Stack:\n"+r.map(function(e){return"    <"+e+">"}).join("\n"))}},{}],3:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){function s(c){(e=c).in(),c.rerun=function(){return s(c)},c.element.mergeProps({children:function(c,s){function e(){var r=arguments,o=c.element.children;if(o&&0<o.length){for(var u=[],i=[],n=(0,l.default)("  "+c.element.name+":children"),e=function(e){var n;if((0,f.default)(o[e]))(n=o[e]).mergeProps.apply(n,r),u.push(function(){return s(c.addChildNode(o[e]))});else if("function"==typeof o[e]){var t=o[e].apply(o,r);(0,f.default)(t)?u.push(function(){return s(c.addChildNode(t))}):i.push(t)}else i.push(o[e])},t=0;t<o.length;t++)e(t);return u.reverse().forEach(function(e){n.prependItem(v,e,function(e){return i.push(e)})}),n.process(),n.onDone(function(){return i})}}return e[a]=!0,e}(c,s)});var n={},t=(0,l.default)(" "+c.element.name);return t.add(d,function(){return c.element.consume()},function(e){return n[d]=e}),t.add(h,function(){var e=n[d];if((0,f.default)(e))t.prependItem(p,function(){return s(c.addChildNode(e))},function(e){return n[p]=e});else if(m(e)){var i=e;t.prependItem(p,function(){return new Promise(function(o){var u=void 0;!function n(e){if((u=i.next(e)).done)if((0,f.default)(u.value)){var t=s(c.addChildNode(u.value));_(t)?t.then(function(e){return o(e)}):o(t)}else o(u.value);else if((0,f.default)(u.value)){var r=s(c.addChildNode(u.value));_(r)?r.then(function(e){return n(e)}):n(r)}}()})},function(e){return n[p]=e})}else e&&e[a]&&t.prependItem(p,function(){return e()},function(e){n[p]=e&&1===e.length?e[0]:e})}),t.process(),t.onDone(function(){return c.out(),p in n?n[p]:n[d]})}var t=(0,r.default)(),e=null;return{node:function(){return e},run:function(e){var n=t.resolveRoot(e);return s(n)},onNodeIn:function(e){t.addNodeInCallback(e)},onNodeOut:function(e){t.addNodeOutCallback(e)},onNodeRemove:function(e){t.onNodeRemove(e)},system:function(){return{tree:t,reset:function(){e=null,t.reset(),o.default.clear(),u.default.clear(),i.default.clear()}}}}};var f=c(e("./utils/isActMLElement")),r=c(e("./Tree")),o=c(e("./hooks/usePubSub")),u=c(e("./hooks/useState")),i=c(e("./hooks/useEffect")),l=c(e("./Queue"));function c(e){return e&&e.__esModule?e:{default:e}}var a="__ACTML_CHILDREN__",d="CONSUME",h="PROCESS_RESULT",p="RETURNED_ELEMENT",v="CHILD",m=function(e){return e&&"function"==typeof e.next},_=function(e){return e&&"function"==typeof e.then}},{"./Queue":4,"./Tree":5,"./hooks/useEffect":7,"./hooks/usePubSub":9,"./hooks/useState":11,"./utils/isActMLElement":14}],4:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function(o){var u=[],i=!1,c=!1,s=function(){};return{add:function(e,n,t){f(o+":Q: [..."+e+"] ("+(u.length+1)+" total)"),u.push(r(e,n,t))},prependItem:function(e,n,t){f(o+":Q: ["+e+"...] ("+(u.length+1)+" total)"),u=[r(e,n,t)].concat(function(e){{if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}}(u))},process:function(e){var n=this;if(c=!0,0===u.length)return f(o+":Q:done"),c=!1,void s();var t=u.shift();f(o+":Q: "+t.type+"() ("+u.length+" left)");var r=t.func(e);l(r)?(i=!0,r.then(function(e){t.onDone(e),n.process(e)}).catch(function(e){s(e)})):(t.onDone(r),this.process(r))},onDone:function(r){return i?new Promise(function(n,t){s=function(e){e?t(e):n(r())}}):r()},isRunning:function(){return c}}};var f=function(){return null},l=function(e){return e&&"function"==typeof e.then},r=function(e,n,t){return{type:e,func:n,onDone:2<arguments.length&&void 0!==t?t:function(){}}}},{}],5:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});Object.assign;t.default=function(){var r=[],o=[],u=[],n=f(),i=0;function c(e,n){return n.initialize(e.element.id,e.element.used()),e.element=n,e}function s(e,n){return!(!e||e.name!==n.name)&&(!e.props||!n.props||e.props.key===n.props.key)}function f(e,n){e&&e.initialize("a"+ ++i);var t={element:e,children:[],parent:n,cursor:0,in:function(){var n=this;l("-> "+this.element.name),this.element.in(),r.forEach(function(e){return e(n)})},out:function(){var n=this;l("<- "+this.element.name),this.element.out(),this.cursor<this.children.length&&this.children.splice(this.cursor,this.children.length-this.cursor).forEach(function(n){return u.forEach(function(e){return e(n)})}),this.cursor=0,o.forEach(function(e){return e(n)})},addChildNode:function(e){var n=this,t=this.children[this.cursor];if(t&&s(t.element,e))return this.cursor+=1,c(t,e);var r=f(e,this);return this.children[this.cursor]&&u.forEach(function(e){return e(n.children[n.cursor])}),this.children[this.cursor]=r,this.cursor+=1,r}};return t}return{resolveRoot:function(e){return n=s(n.element,e)?c(n,e):f(e)},reset:function(){n=f(),i=0},getNumOfElements:function(){return i},diagnose:function(){throw new Error("Not available in production mode")},addNodeInCallback:function(e){r.push(e)},addNodeOutCallback:function(e){o.push(e)},onNodeRemove:function(e){u.push(e)}}};var l=function(){return null}},{}],6:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=e("./utils/isValidHookContext"),u=(r=o)&&r.__esModule?r:{default:r},i=e("../Context");t.default=function(n){return function(e){return(0,u.default)(n),e[i.PUBLIC_CONTEXT_KEY]()}}},{"../Context":2,"./utils/isValidHookContext":12}],7:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=r(e("fast-deep-equal")),i=r(e("./utils/isValidHookContext"));function r(e){return e&&e.__esModule?e:{default:e}}var c={elements:{},get:function(e){return this.elements[e.id]?this.elements[e.id]:this.elements[e.id]={effects:[],consumer:0}},cleanUp:function(e){this.elements[e]&&delete this.elements[e]}};function o(e,n){var t=n.deps,r=n.oldDeps,o=n.callback;if(void 0===t)n.cleanUp=o();else if(0===t.length)1===e.element.used()&&(n.cleanUp=o());else{(function(e,n){return!!e&&(e.length===n.length&&(0,u.default)(e,n))})(r,t)||(n.cleanUp=o())}}function s(u){return u.onNodeRemove(function(e){var n=e.element;c.get(n).effects.forEach(function(e){e.cleanUp&&e.cleanUp()}),c.cleanUp(e.element.id)}),u.onNodeOut(function(n){var e=n.element,t=c.get(e);0<t.effects.length&&t.effects.forEach(function(e){return o(n,e)})}),function(e,n){(0,i.default)(u);var t=u.node().element,r=c.get(t);if(0===t.used())r.effects.push(function(e,n){return{callback:e,deps:n}}(e,n));else{var o=r.consumer;r.consumer=o<r.effects.length-1?r.consumer+1:0,function(e,n,t){e.callback=n,e.oldDeps=e.deps,e.deps=t}(r.effects[o],e,n)}}}(t.default=s).clear=function(){c.elements={}}},{"./utils/isValidHookContext":12,"fast-deep-equal":15}],8:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,o=e("./utils/isValidHookContext"),u=(r=o)&&r.__esModule?r:{default:r};t.default=function(e){return function(){return(0,u.default)(e),e.node().element}}},{"./utils/isValidHookContext":12}],9:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=f;var r,o=e("./utils/isValidHookContext"),u=(r=o)&&r.__esModule?r:{default:r};var i={},c=function(e,n,t,r){return i[t]||(i[t]={}),i[t][n.id]=r,function(){delete i[t][n.id]}},s=function(e,n,t){i[n]&&Object.keys(i[n]).forEach(function(e){i[n][e](t)})};function f(n){return n.onNodeRemove(function(n){Object.keys(i).forEach(function(e){i[e][n.element.id]&&delete i[e][n.element.id]})}),function(e){(0,u.default)(n);var r=n.node(),o=e||r.element;return{subscribe:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return c.apply(void 0,[r,o].concat(n))},publish:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return s.apply(void 0,[r].concat(n))},subscribers:i}}}f.clear=function(){i={}}},{"./utils/isValidHookContext":12}],10:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,n){var t=[],r=!0,o=!1,u=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done)&&(t.push(i.value),!n||t.length!==n);r=!0);}catch(e){o=!0,u=e}finally{try{!r&&c.return&&c.return()}finally{if(o)throw u}}return t}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")};t.default=function(c,s){return function(n,e){(0,l.default)(c);c.node();function t(e){i(n(u(),e))}var r=s(e),o=f(r,2),u=o[0],i=o[1];return[u,t,function(o){return function(e){var n=e.action,t=e.propsToAction,r=function(e,n){var t={};for(var r in e)0<=n.indexOf(r)||Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}(e,["action","propsToAction"]);if(n)o(n);else{if(!t)throw new Error('<Dispatch> expects "action" or "propsToAction" prop.');o(t(r))}}}(t),function(){return u()}]}};var r,o=e("./utils/isValidHookContext"),l=(r=o)&&r.__esModule?r:{default:r}},{"./utils/isValidHookContext":12}],11:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=u;var r,o=e("./utils/isValidHookContext"),i=(r=o)&&r.__esModule?r:{default:r};var c={elements:{},get:function(e){return this.elements[e.id]?this.elements[e.id]:this.elements[e.id]={states:[],consumer:0}},cleanUp:function(e){this.elements[e]&&delete this.elements[e]}};function u(u){return u.onNodeRemove(function(e){return c.cleanUp(e.element.id)}),function(e){(0,i.default)(u);var n=u.node(),t=n.element,r=c.get(t),o=void 0;return 0===t.used()?(r.states.push(e),o=r.states.length-1):(o=r.consumer,r.consumer=o<r.states.length-1?r.consumer+1:0),[function(){return r.states[o]},function(e){return r.states[o]=e,t.isRunning()||n.rerun(),e}]}}u.clear=function(){c.elements={}}},{"./utils/isValidHookContext":12}],12:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(!e)throw new Error("Something terribly wrong happened. The hook factory function is called without a processor.");if(!e.node())throw new Error("Hooks must be called in the context of an ActML element.")}},{}],13:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createRuntime=o;var s=r(e("./Processor")),f=r(e("./utils/isActMLElement")),l=r(e("./ActElement")),a=r(e("./hooks/useElement")),d=r(e("./hooks/usePubSub")),h=r(e("./hooks/useState")),p=r(e("./hooks/useReducer")),v=r(e("./hooks/useEffect")),m=r(e("./hooks/useContext")),_=r(e("./Context"));function r(e){return e&&e.__esModule?e:{default:e}}function o(){var n=(0,s.default)();var e=(0,a.default)(n),t=(0,h.default)(n),r=(0,d.default)(n),o=(0,p.default)(n,t),u=(0,v.default)(n),i=(0,m.default)(n),c=(0,_.default)(n);return{A:function(e,n){for(var t=arguments.length,r=Array(2<t?t-2:0),o=2;o<t;o++)r[o-2]=arguments[o];return(0,l.default)(e,n,r)},run:function(e){if(!(0,f.default)(e))throw new Error("ActML element expected. Instead "+e.toString()+" passed.");return n.run(e)},Fragment:function(e){return e.children},processor:n,useElement:e,usePubSub:r,useState:t,useReducer:o,useEffect:u,useContext:i,createContext:c}}var u=o();n.exports=u,n.exports.createRuntime=o()},{"./ActElement":1,"./Context":2,"./Processor":3,"./hooks/useContext":6,"./hooks/useEffect":7,"./hooks/useElement":8,"./hooks/usePubSub":9,"./hooks/useReducer":10,"./hooks/useState":11,"./utils/isActMLElement":14}],14:[function(e,n,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&!0===e.__actml}},{}],15:[function(e,n,t){"use strict";var h=Array.isArray,p=Object.keys,v=Object.prototype.hasOwnProperty;n.exports=function e(n,t){if(n===t)return!0;if(n&&t&&"object"==typeof n&&"object"==typeof t){var r,o,u,i=h(n),c=h(t);if(i&&c){if((o=n.length)!=t.length)return!1;for(r=o;0!=r--;)if(!e(n[r],t[r]))return!1;return!0}if(i!=c)return!1;var s=n instanceof Date,f=t instanceof Date;if(s!=f)return!1;if(s&&f)return n.getTime()==t.getTime();var l=n instanceof RegExp,a=t instanceof RegExp;if(l!=a)return!1;if(l&&a)return n.toString()==t.toString();var d=p(n);if((o=d.length)!==p(t).length)return!1;for(r=o;0!=r--;)if(!v.call(t,d[r]))return!1;for(r=o;0!=r--;)if(!e(n[u=d[r]],t[u]))return!1;return!0}return n!=n&&t!=t}},{}]},{},[13])(13)});